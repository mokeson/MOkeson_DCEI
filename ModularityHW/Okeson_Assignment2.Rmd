---
title: "Okeson_Assignment2"
author: "Morgan Okeson"
date: "February 14, 2018"
output: html_document
---

<!---Chunk for prep--->
```{r echo=F}
#Modularity lessons 4 and 5: I started out by orginizing chunks based on what I knew I had to do- 1) what I would need for input 2) what I would get an an output, 3) type of code I would need to write.
#Modularity lesson 7: by using block headers I was able to come back to the code I wanted to write later and have an idea of the direction I had planned out. 

#Load required packages
library(knitr)
library(data.table)
library(maps)
library(ggplot2)
library(ggmap)
library(mapdata)
#Packages for subsetting climate data
library(dplyr)
library(stringr)
knitr::opts_chunk$set(cache=T)

```

<!---Chunk for loading the data--->
```{r echo=F, cache=T}
#Modularity lesson 2: Think about goals- I can read a replacement file easily here and won't have to change the code below
#Modularity lesson 3: Revised my code on 03/22/2018 because I noticed errors and found better ways to clean the data

#Import Data
temp<-readRDS(file="./Data/USAAnnualTemp1950_2016.rds")
pcpn<-readRDS(file="./Data/USAAnnualPcpn1950_2016.rds")

```

<!---Chunk for subsetting the data--->
```{r echo=F, cache=T}
#subset data using aggregate function
ag1.temp<-aggregate(temp$value, by= temp[c("lat","lon")],FUN=mean)
ag1.temp$count<-aggregate(temp$value, by= temp[c("lat","lon")],FUN=length)[,3]
gt40<-ag1.temp[ag1.temp$count>40,]
#setup for () loop
  #where we will put the good indicies
goodinds<-c()
  #loop
for (counter in 1:nrow(temp))
{
  #extract lat and lon for row counter of temp
  exrow<-temp[counter,c("lat","lon")]
  
  #See if it matches any of the lat lon from gt40, if it does add counter into goodinds
  matches<-which((abs(exrow[1]- gt40$lat)<1e-5) & (abs(exrow[2]- gt40$lon)<1e-5))
  if (length(matches)>0)
  {
    #add counter to goodinds
    goodinds<-c(goodinds,counter)
  }
}
#throw out the rows of temp that are not in goodinds
temp<-temp[goodinds,]

```

<!---Chunk for Linear Regression--->
```{r echo=F, cache=T}
#Linear regression
#Dependent on finding locations with 40+ years of data
#Used to find intercept and slope
  #Will plot slopes on a map, larger slope = more warming

#prepare rec. for saving slopes
  #could use gt40, would need new column 
gt40$slopes<-c()[,4]

#for each weather station name/ row of gt40
for(counter in 1:nrow(temp))
  {
  #extract data from each weather station in new temp df
  
  #run linear regression
  lm(year~value,temp)
  
  #save slopes in gt40
  
}

```


<!---Chunk for preparing for mapping--->
```{r echo=F, cache=T}


```

<!---Chunk for Temp Map--->
```{r echo=F, cache=T}

```

<!---Chunk for Precip Map--->
```{r echo=F, cache=T}

```